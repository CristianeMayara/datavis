<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Gráficos Utilizando D3, Crossfilter e DC</title>
    <link rel="stylesheet" href="css/dc.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/dc.js" charset="utf-8"></script>

</head>
<body>
    <div id="chart" class="chartClass"><center><span> Apuração na Bilheteria de Filmes por Ano</span></center><br></div>

    <div id="chart2" class="chartClass"><center><span> Apuração na Bilheteria de Filmes por Gênero</span></center><br></div>

	<script type="text/javascript">
        var barChart = dc.barChart('#chart');

        d3.json("movies.json", function(data){

            // formatando nossos dados
            data.forEach(function(d){
                d.Year = d.Year;
                d.Worldwide_Gross_M = +d.Worldwide_Gross_M;
            });

            //criando um crossfilter
            var facts = crossfilter(data);

            var dateDim = facts.dimension(function(d){
                return d.Year;
            });

            var grossByYearGroup = dateDim.group().reduceSum(function(d){
                return d.Worldwide_Gross_M;
            });

            barChart.width(800)
                     .height(400)
                     .margins({top: 30, right: 50, bottom: 25, left: 40})
                     .dimension(dateDim)
                     .x(d3.scale.linear().domain([2006,2013]))
                     //.xUnits(dc.units.integers)
                     //.x(d3.time.scale().domain(d3.extent(data, function(d){ return d.Year; })))
                     //.x(d3.time.scale().domain([new Date(2006), new Date(2012)]))
                     //.xUnits(d3.time.years)
                     //.round(d3.time.year.round)
                     .renderHorizontalGridLines(true)
                     .yAxisLabel('Valor (US$) arrecadado')
                     .xAxisLabel('Anos')
                     .ordinalColors(['#00CED1'])
                     //.legend(dc.legend().x(650).y(10).itemHeight(13).gap(5))
                     .brushOn(false)
                     .group(grossByYearGroup, 'Gross');
            
            barChart.xAxis().tickFormat(d3.format("d"));
            barChart.margins().bottom += 15;

            dc.renderAll();
        });

        var barChart2 = dc.barChart('#chart2');

        d3.json("movies.json", function(data){

            // formatando nossos dados
            data.forEach(function(d){
                d.Genre = d.Genre;
                d.Worldwide_Gross_M = +d.Worldwide_Gross_M;
            });

            //criando um crossfilter
            var facts = crossfilter(data);

            var genreDim = facts.dimension(function(d){
                return d.Genre;
            });

            var grossByGenreGroup = genreDim.group().reduceSum(function(d){
                return d.Worldwide_Gross_M;
            });

            var genreGroup = genreDim.group();

            barChart2.width(800)
                     .height(400)
                     .margins({top: 30, right: 50, bottom: 25, left: 40})
                     .dimension(genreDim)
                     .x(d3.scale.ordinal().range([0,2]).domain(data.map(function (d) {return d.Genre; })))
                     .xUnits(dc.units.ordinal)
                     .renderHorizontalGridLines(true)
                     .yAxisLabel('Valor (US$) arrecadado')
                     .xAxisLabel('Gêneros')
                     .ordinalColors(['#c71585'])
                     .brushOn(false)
                     .group(grossByGenreGroup, 'Gross');

            barChart2.margins().bottom += 15;

            dc.renderAll();
        });
	</script>			
</body>
</html>